<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --hm-green: #008744;
            --hm-blue: #005691;
        }

        .sidebar {
            width: 250px;
            background-color: var(--hm-blue);
            color: white;
            min-height: 100vh;
        }

        .sidebar .nav-link {
            color: white;
            padding: 10px 15px;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.15);
        }

        .card-kpi {
            border-left: 5px solid var(--hm-green);
        }

        .text-hm-green {
            color: var(--hm-green);
        }

        .text-hm-blue {
            color: var(--hm-blue);
        }
    </style>
</head>

<body>
<div class="d-flex">

    <!-- Sidebar -->
    <div class="sidebar p-3 shadow">
        <h4 class="text-white mb-4">CLINIC HUB</h4>
        <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link active" th:href="@{/admin/dashboard}"><i class="fas fa-chart-line me-2"></i>Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" th:href="@{/admin/patient}"><i class="fas fa-users me-2"></i>Patients</a></li>
            <li class="nav-item"><a class="nav-link" th:href="@{/admin/doctor}"><i class="fas fa-user-md me-2"></i>Doctors</a></li>
            <li class="nav-item"><a class="nav-link" th:href="@{/admin/receptionist}"><i class="fas fa-hospital-user me-2"></i>Receptionists</a></li>
            <li class="nav-item"><a class="nav-link" th:href="@{/admin/cashier}"><i class="fas fa-cash-register me-2"></i>Cashiers</a></li>
            <li class="nav-item"><a class="nav-link" th:href="@{/admin/technician}"><i class="fas fa-user-gear me-2"></i>Technicians</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="flex-grow-1 p-4 bg-light">

        <div class="d-flex justify-content-end" th:insert="~{fragment/fragment :: navLogin}"></div>

        <h2 class="text-hm-blue mb-4">Admin Dashboard</h2>

        <!-- Filter Dropdown -->
        <div class="dropdown mb-4">
            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="filterDropdown"
                    data-bs-toggle="dropdown" aria-expanded="false">
                Filter: <span th:text="${filter == 'today' ? 'Today' : (filter == 'year' ? 'This Year' : 'This Month')}"></span>
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" th:href="@{/admin/dashboard(filter='today')}">Today</a></li>
                <li><a class="dropdown-item" th:href="@{/admin/dashboard(filter='month')}">This Month</a></li>
                <li><a class="dropdown-item" th:href="@{/admin/dashboard(filter='year')}">This Year</a></li>
            </ul>
        </div>

        <!-- KPI Section -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card card-kpi p-3 shadow-sm">
                    <div class="text-secondary"
                         th:text="${filter == 'today' ? 'Revenue (Today)' : (filter == 'year' ? 'Revenue (This Year)' : 'Revenue (This Month)')}"></div>
                    <h3 class="text-hm-green" th:text="${#numbers.formatCurrency(revenue)}"></h3>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-kpi p-3 shadow-sm">
                    <div class="text-secondary">Total Patients</div>
                    <h3 class="text-hm-blue" th:text="${totalPatients}"></h3>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card card-kpi p-3 shadow-sm">
                    <div class="text-secondary">Avg Rating</div>
                    <h3 class="text-hm-green" th:text="${#numbers.formatDecimal(avgRating,1,1)}"></h3>
                </div>
            </div>
        </div>

        <!-- Chart Section -->
        <div class="row mb-8">
                <div class="card p-3 shadow-sm">
                    <h5 class="text-hm-blue">Revenue Trend</h5>
                    <canvas id="revenueChart" height="150"></canvas>
                </div>
        </div>

        <!-- Feedback Section -->
        <div class="card p-3 shadow-sm">
            <h5 class="text-hm-green mb-3"><i class="fas fa-comments me-2"></i>Recent Feedback</h5>
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Patient ID</th>
                    <th>Patient Name</th>
                    <th>Rating</th>
                    <th>Comment</th>
                    <th>Date</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="fb : ${feedbacks}">
                    <td th:text="${fb.feedbackId}"></td>
                    <td th:text="${fb.patient.fullName}"></td>
                    <td><span class="badge bg-success" th:text="${fb.rating}"></span></td>
                    <td th:text="${fb.comment}"></td>
                    <td th:text="${#temporals.format(fb.createdAt,'dd-MM-yyyy')}"></td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<script th:inline="javascript">
    let labels = /*[[${chartLabels}]]*/ [];
    let revenueData = /*[[${chartRevenue}]]*/ [];

    const ctx = document.getElementById('revenueChart');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Revenue ($)',
                data: revenueData,
                borderColor: '#008744',
                backgroundColor: 'rgba(0, 135, 68, 0.2)',
                fill: true,
                tension: 0.3
            }]
        }
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
