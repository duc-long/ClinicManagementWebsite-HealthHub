<!--Home -->
<div th:fragment="home">
    <div class="row g-3 mb-2">
        <div class="col-md-4">
            <div class="card-soft">
                <div class="d-flex align-items-center justify-content-between">
                    <div>
                        <div class="text-muted small">Today Appointments</div>
                        <div class="h4 fw-bold" th:text="${todayCount}">8</div>
                    </div>
                    <i class="fa-solid fa-calendar-day fa-xl"></i>
                </div>
            </div>
        </div>
    </div>
    <hr/>
    <div class="card p-3">
        <div class="section-title">
            <i class="fa-solid fa-calendar-check me-2"></i>
            Patient Appointments
        </div>

        <!-- üîç Search bar -->
        <form class="row g-3 mb-4" th:action="@{/doctor/home}" method="get">
            <div class="col-md-4">
                <input type="text" name="patientName" class="form-control"
                       placeholder="Search by patient name" th:value="${param.patientName}">
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary w-100" type="submit">
                    <i class="fa-solid fa-magnifying-glass me-1"></i>Search
                </button>
            </div>
        </form>

        <!-- üìÖ Appointment list -->
        <div class="table-responsive">
            <table class="table align-middle">
                <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Patient Name</th>
                    <th>Appointment Date</th>
                    <th>Queue Number</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="appt, iter : ${appointments}">
                    <td th:text="${iter.count}"></td>
                    <td th:text="${appt.patientName}"></td>
                    <td th:text="${#temporals.format(appt.appointmentDate, 'dd/MM/yyyy')}"></td>
                    <td th:text="${appt.queueNumber}"></td>
                    <td>
                            <span th:switch="${appt.status.value}">
                                    <span th:case="0" class="badge bg-secondary">Pending</span>
                                    <span th:case="1" class="badge bg-info">Confirmed</span>
                                    <span th:case="2" class="badge bg-danger">Cancelled</span>
                                    <span th:case="3" class="badge bg-success">Paid</span>
                                    <span th:case="4" class="badge bg-dark">No Show</span>
                                    <span th:case="5" class="badge bg-primary">Checked In</span>
                                    <span th:case="6" class="badge bg-warning text-dark">Examined</span>
                            </span>
                    </td>
                    <td th:text="${appt.notes ?: '-'}"></td>
                    <td>
                        <a th:href="@{/doctor/appointments/detail/{id}(id=${appt.appointmentId})}"
                           class="btn btn-outline-primary btn-sm">
                            <i class="fa-solid fa-eye"></i> Start Examination
                        </a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(appointments)}">
                    <td colspan="7" class="text-center text-muted py-4">
                        <i class="fa-solid fa-inbox me-2"></i>No appointments found
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Appointment -->
<div th:fragment="search-appointments">
    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h5 class="m-0 fw-bold">
            <i class="fa-solid fa-calendar-check me-2"></i>Appointments
        </h5>
        <div class="d-flex gap-2">
            <input class="form-control" placeholder="Search patient / reason..." style="max-width:260px"/>
            <button class="btn btn-primary">
                <i class="fa-solid fa-magnifying-glass me-1"></i> Search
            </button>
        </div>
    </div>

    <!-- Content -->
    <div class="table-responsive">
        <!-- üü• Khi KH√îNG c√≥ d·ªØ li·ªáu -->
        <div th:if="${appointments == null or #lists.isEmpty(appointments)}"
             class="alert alert-info text-center mt-3" role="alert">
            <i class="fa-solid fa-circle-info me-2"></i>
            No appointment data available.
        </div>

        <!-- üü© Khi C√ì d·ªØ li·ªáu -->
        <table th:if="${appointments != null and !#lists.isEmpty(appointments)}"
               class="table align-middle">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Patient</th>
                <th>Time</th>
                <th>Reason</th>
                <th class="text-end">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="a, i : ${appointments}">
                <td th:text="${i.index + 1}"></td>
                <td th:text="${a.patientName}">Tran Van A</td>
                <td>
                    <span th:text="${#temporals.format(a.appointmentDate, 'dd/MM/yyyy')}"></span>
                </td>
                <td th:text="${a.notes}">Chest pain</td>
                <td class="text-end">
                    <a th:href="@{/doctor/appointments/detail/{id}(id = ${a.appointmentId})}"
                       class="btn btn-sm btn-outline-warning">
                        <i class="fa-solid fa-folder-open me-1"></i> Open
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- appointment-detail -->
<div th:fragment="appointment-detail">
    <style>
        .card-soft {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            padding: 24px;
        }

        .info-label {
            font-weight: 600;
            color: #4f8cff;
            width: 160px;
        }

        .info-value {
            font-weight: 500;
            color: #333;
        }

        .btn-hm-primary {
            background-color: #4f8cff;
            border-color: #4f8cff;
            color: #fff;
            transition: 0.2s;
        }

        .btn-hm-primary:hover {
            background-color: #3f78e0;
            border-color: #3f78e0;
        }

        .btn-hm-secondary {
            border-color: #4f8cff;
            color: #4f8cff;
        }

        .btn-hm-secondary:hover {
            background-color: #4f8cff;
            color: #fff;
        }

        .section-title {
            color: #0b1a3a;
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
    </style>

    <div>
        <div class="d-flex align-items-center justify-content-between mb-4">
            <h5 class="section-title mb-0">
                <i class="fa-solid fa-file-medical me-2"></i> Appointment Details
            </h5>
            <span th:text="${#temporals.format(appointment.appointmentDate, 'dd/MM/yyyy')}"
                  class="text-muted small"></span>
        </div>

        <div class="card-soft">
            <div class="row mb-3">
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <span class="info-label"><i class="fa-solid fa-user me-2"></i>Patient:</span>
                        <span class="info-value" th:text="${appointment.patientName}">Tran Van A</span>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <span class="info-label"><i class="fa-solid fa-user-doctor me-2"></i>Doctor:</span>
                        <span class="info-value" th:text="${appointment.doctorName}">Dr. Nguyen Quoc Kiet</span>
                    </div>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <span class="info-label"><i class="fa-solid fa-calendar-days me-2"></i>Date:</span>
                        <span class="info-value"
                              th:text="${#temporals.format(appointment.appointmentDate, 'dd/MM/yyyy')}">23/10/2025</span>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <div class="d-flex align-items-center">
                        <span class="info-label"><i class="fa-solid fa-clock me-2"></i>Created At:</span>
                        <span class="info-value"
                              th:text="${#temporals.format(appointment.createdAt, 'HH:mm dd/MM/yyyy')}">10:30 22/10/2025</span>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <div class="d-flex align-items-start">
                    <span class="info-label"><i class="fa-solid fa-comment-medical me-2"></i>Reason:</span>
                    <span class="info-value" th:text="${appointment.notes}">Chest pain and dizziness</span>
                </div>
            </div>

            <div class="mt-4 d-flex justify-content-end gap-2">
                <!-- üîô Back to Appointments -->
                <a class="btn btn-hm-secondary"
                   th:href="@{/doctor/home}">
                    <i class="fa-solid fa-arrow-left me-1"></i> Back to Home
                </a>

                <!-- N·∫øu ch∆∞a c√≥ record -->
                <a th:if="${recordId == null}"
                   type="button"
                   class="btn btn-hm-primary"
                   th:href="@{/doctor/records/new(appointmentId=${appointment.appointmentId}, patientId=${appointment.patientId})}">
                    <i class="fa-solid fa-stethoscope me-1"></i> Create Medical Record
                </a>

                <!-- N·∫øu ƒë√£ c√≥ record -->
                <a th:if="${recordId != null}"
                   type="button"
                   class="btn btn-outline-hm-primary"
                   th:href="@{/doctor/records/detail/{recordId}(recordId=${recordId})}">
                    <i class="fa-solid fa-file-medical me-1"></i> View Medical Record
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Vital Sign -->
<div th:fragment="vital-create">
    <div class="card p-4 shadow-sm">
        <h5 class="text-primary mb-3">
            <i class="fa-solid fa-heart-pulse me-2"></i> Record Vital Signs
        </h5>

        <form th:action="@{/doctor/vitals/save}" method="post" th:object="${vitalDTO}">
            <input type="hidden" th:field="${record.recordId}" th:value="${record.recordId}"/>

            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Height (cm)</label>
                    <input type="number" step="0.1" th:field="*{heightCm}" class="form-control" required>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Weight (kg)</label>
                    <input type="number" step="0.1" th:field="*{weightKg}" class="form-control" required>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Heart Rate (bpm)</label>
                    <input type="number" th:field="*{heartRate}" class="form-control" required>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Blood Pressure (mmHg)</label>
                    <div class="input-group">
                        <input type="number" th:field="*{systolic}" class="form-control" placeholder="Systolic">
                        <span class="input-group-text">/</span>
                        <input type="number" th:field="*{diastolic}" class="form-control" placeholder="Diastolic">
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Temperature (¬∞C)</label>
                    <input type="number" step="0.1" th:field="*{temperature}" class="form-control">
                </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
                <a th:href="@{/doctor/home}" class="btn btn-outline-secondary">
                    <i class="fa-solid fa-arrow-left"></i> Back Home
                </a>
                <button type="submit" class="btn btn-success ms-2">
                    <i class="fa-solid fa-floppy-disk"></i> Save
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Patients -->
<div th:fragment="patient">
    <h5 class="fw-bold mb-3"><i class="fa-solid fa-user-group me-2"></i>Patients</h5>
    <div class="row g-3">
        th:each="p : ${patients}"
        <div class="col-md-6 col-xl-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex align-items-center gap-3">
                        <div>
                            <div class="fw-semibold" th:text="${p.fullName}">Nguyen Thi B</div>
                            <div class="text-muted small" th:text="${p.gender} + ' ' + ${p.birthdate}">Female ¬∑ 28</div>
                        </div>
                    </div>
                    <div class="mt-3 d-flex gap-2">
                        <a href="#" class="btn btn-sm btn-outline-primary">Records</a>
                        <a href="#" class="btn btn-sm btn-outline-secondary">Book</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Profile -->
<div th:fragment="profile">
    <style>
        .card-soft {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .text-hm-blue {
            color: #4f8cff;
        }

        .btn-outline-secondary:hover {
            background-color: #4f8cff;
            color: #fff;
            border-color: #4f8cff;
        }
    </style>

    <h5 class="fw-bold mb-3">
        <i class="fa-solid fa-user-doctor me-2"></i>Doctor Profile
    </h5>

    <div class="row g-4">
        <!-- Left column: Personal info -->
        <div class="col-lg-8">
            <div class="card-soft p-4">
                <h6 class="fw-semibold mb-3 text-hm-blue">Personal Information</h6>
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Full Name</label>
                    <input type="text" class="form-control"
                           th:value="${doctor.fullName} ?: '‚Äî'"
                           name="fullName" readonly>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Email</label>
                    <input type="email" class="form-control"
                           th:value="${doctor.email} ?: '‚Äî'"
                           name="email" readonly>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Phone</label>
                    <input type="text" class="form-control"
                           th:value="${doctor.phone} ?: '‚Äî'"
                           name="phone" readonly>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Department</label>
                    <input type="text" class="form-control"
                           th:value="${department} ?: '‚Äî'"
                           name="department" readonly>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Gender</label>
                    <input type="text" class="form-control"
                           th:value="${doctor.gender} ?: '‚Äî'"
                           name="gender" readonly>
                </div>

                <div class="col-12 text-end mt-3 d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-outline-secondary">
                        <i class="fa-solid fa-key me-1"></i> Change Password
                    </button>
                    <a th:href="@{/doctor/profile/edit/{id}(id=${doctor.doctorId})}" class="btn btn-primary">
                        <i class="fa-solid fa-pen-to-square me-1"></i> Edit Profile
                    </a>
                </div>
            </div>
        </div>

        <!-- Right column: Avatar -->
        <div class="col-lg-4">
            <div class="card-soft text-center p-4">
                <img th:src="${doctor.avatarFileName != null} ? '/images/avatars/doctor' + ${doctor.avatarFileName} : '/images/avatars/default-avatar.png'"
                     class="rounded-circle shadow mb-3 border border-3 border-light"
                     width="140" height="140" alt="Avatar">

                <h6 class="fw-bold mb-1" th:text="${doctor.fullName}">Dr. Nguyen Quoc Kiet</h6>
                <div class="text-muted small mb-3" th:text="${department}">Department</div>

                <form th:action="@{/doctor/avatarFilename}" method="post" enctype="multipart/form-data">
                    <input type="file" name="avatar" class="form-control mb-2" accept="image/*">
                    <button class="btn btn-outline-primary btn-sm w-100">
                        <i class="fa-solid fa-upload me-1"></i> Update Avatar
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Medical Record -->
<div th:fragment="medicalRecord">
    <style>
        :root {
            --hm-blue: #005691;
            --hm-green: #008744;
        }

        .section-title {
            font-weight: 600;
            color: var(--hm-blue);
        }

        .btn-hm {
            background-color: var(--hm-blue);
            color: white;
        }

        .btn-hm:hover {
            background-color: #003f6f;
            color: #fff;
        }

        .table-hover tbody tr:hover {
            background-color: #f5f8fb;
        }

        .badge-status {
            font-size: 0.85rem;
        }
    </style>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="section-title mb-0"><i class="fa-solid fa-file-medical me-2"></i>H·ªì s∆° b·ªánh √°n</h4>
        <a th:href="@{/doctor/records/new}" class="btn btn-hm">
            <i class="fa-solid fa-plus me-1"></i> Th√™m h·ªì s∆°
        </a>
    </div>

    <!-- Filter/Search -->
    <form th:action="@{/doctor/records}" method="get" class="row g-2 mb-3">
        <div class="col-md-4">
            <input type="text" name="keyword" th:value="${keyword}" class="form-control"
                   placeholder="T√¨m theo t√™n b·ªánh nh√¢n ho·∫∑c ch·∫©n ƒëo√°n...">
        </div>
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="">-- Tr·∫°ng th√°i --</option>
                <option th:each="s : ${T(com.group4.clinicmanagement.enums.RecordStatus).values()}"
                        th:value="${s.name()}"
                        th:text="${s.displayName}"
                        th:selected="${status == s.name()}">
                </option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-outline-primary w-100">
                <i class="fa-solid fa-search me-1"></i> L·ªçc
            </button>
        </div>
    </form>

    <!-- Table -->
    <div class="table-responsive shadow-sm rounded bg-white p-3">
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>B·ªánh nh√¢n</th>
                <th>Ch·∫©n ƒëo√°n</th>
                <th>Ghi ch√∫</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Ng√†y t·∫°o</th>
                <th class="text-center">Thao t√°c</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="record, iStat : ${records}">
                <td th:text="${iStat.index + 1}"></td>
                <td th:text="${record.patient.fullName}"></td>
                <td th:text="${#strings.abbreviate(record.diagnosis, 40)}"></td>
                <td th:text="${#strings.abbreviate(record.notes, 40)}"></td>

                <td>
                    <span th:switch="${record.status.name()}">
                        <span th:case="'OPEN'" class="badge bg-success badge-status">M·ªü</span>
                        <span th:case="'IN_PROGRESS'" class="badge bg-warning text-dark badge-status">ƒêang x·ª≠ l√Ω</span>
                        <span th:case="'CLOSED'" class="badge bg-secondary badge-status">ƒê√£ ƒë√≥ng</span>
                        <span th:case="*"
                              class="badge bg-light text-dark badge-status">Kh√¥ng x√°c ƒë·ªãnh</span>
                    </span>
                </td>

                <td th:text="${#temporals.format(record.createdAt, 'dd/MM/yyyy HH:mm')}"></td>

                <td class="text-center">
                    <a th:href="@{'/doctor/records/' + ${record.recordId}}" class="btn btn-sm btn-outline-info me-1">
                        <i class="fa-solid fa-eye"></i>
                    </a>
                    <a th:href="@{'/doctor/records/edit/' + ${record.recordId}}" class="btn btn-sm btn-outline-primary">
                        <i class="fa-solid fa-pen"></i>
                    </a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(records)}">
                <td colspan="7" class="text-center text-muted py-3">
                    <i class="fa-regular fa-folder-open me-1"></i> Ch∆∞a c√≥ h·ªì s∆° n√†o ƒë∆∞·ª£c t·∫°o
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Prescription -->
<div th:fragment="prescription">
    <style>
        :root {
            --hm-blue: #005691;
            --hm-green: #008744;
            --hm-light: #f8f9fa;
        }

        .section-title {
            font-weight: 600;
            color: var(--hm-blue);
        }

        .btn-hm {
            background-color: var(--hm-blue);
            color: white;
        }

        .btn-hm:hover {
            background-color: #003f6f;
            color: #fff;
        }

        .table-hover tbody tr:hover {
            background-color: #f5f8fb;
        }

        .badge-status {
            font-size: 0.85rem;
        }

        .drug-detail-list li {
            font-size: 0.9rem;
        }
    </style>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="section-title mb-0"><i class="fa-solid fa-prescription-bottle-medical me-2"></i>Prescription</h4>
        <a th:href="@{/doctor/prescriptions/new}" class="btn btn-hm">
            <i class="fa-solid fa-plus me-1"></i> Create new Prescription
        </a>
    </div>

    <!-- Filter/Search -->
    <form th:action="@{/doctor/prescriptions}" method="get" class="row g-2 mb-3">
        <div class="col-md-4">
            <input type="text" name="keyword" th:value="${keyword}" class="form-control"
                   placeholder="T√¨m theo t√™n b·ªánh nh√¢n ho·∫∑c ch·∫©n ƒëo√°n...">
        </div>
        <div class="col-md-3">
            <select name="status" class="form-select">
                <option value="">-- Tr·∫°ng th√°i --</option>
                <option th:each="s : ${T(com.group4.clinicmanagement.enums.PrescriptionStatus).values()}"
                        th:value="${s.name()}"
                        th:text="${s.displayName}"
                        th:selected="${status == s.name()}">
                </option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-outline-primary w-100">
                <i class="fa-solid fa-search me-1"></i> L·ªçc
            </button>
        </div>
    </form>

    <!-- Table -->
    <div class="table-responsive shadow-sm rounded bg-white p-3">
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>B·ªánh nh√¢n</th>
                <th>B√°c sƒ© k√™ toa</th>
                <th>Chi ti·∫øt thu·ªëc</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Ng√†y k√™ toa</th>
                <th class="text-center">Thao t√°c</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="prescription, iStat : ${prescriptions}">
                <td th:text="${iStat.index + 1}"></td>
                <td th:text="${prescription.medicalRecord.patient.fullName}"></td>
                <td th:text="${prescription.doctor.user.fullName}"></td>

                <td>
                    <ul class="mb-0 drug-detail-list" th:if="${!#lists.isEmpty(prescription.details)}">
                        <li th:each="detail : ${prescription.details}">
                            <span th:text="${detail.drug.drugName}"></span> ‚Äì
                            <span th:text="${detail.dosage}"></span>
                            (<span th:text="${detail.quantity}"></span> vi√™n)
                        </li>
                    </ul>
                    <span th:if="${#lists.isEmpty(prescription.details)}" class="text-muted fst-italic">
                        Ch∆∞a c√≥ thu·ªëc
                    </span>
                </td>

                <td>
                    <span th:switch="${prescription.status.name()}">
                        <span th:case="'ACTIVE'" class="badge bg-success badge-status">ƒêang hi·ªáu l·ª±c</span>
                        <span th:case="'COMPLETED'" class="badge bg-secondary badge-status">Ho√†n t·∫•t</span>
                        <span th:case="'CANCELLED'" class="badge bg-danger badge-status">ƒê√£ h·ªßy</span>
                        <span th:case="*" class="badge bg-light text-dark badge-status">Kh√¥ng x√°c ƒë·ªãnh</span>
                    </span>
                </td>

                <td th:text="${#temporals.format(prescription.prescribedAt, 'dd/MM/yyyy HH:mm')}"></td>

                <td class="text-center">
                    <a th:href="@{'/doctor/prescriptions/' + ${prescription.prescriptionId}}"
                       class="btn btn-sm btn-outline-info me-1">
                        <i class="fa-solid fa-eye"></i>
                    </a>
                    <a th:href="@{'/doctor/prescriptions/edit/' + ${prescription.prescriptionId}}"
                       class="btn btn-sm btn-outline-primary">
                        <i class="fa-solid fa-pen"></i>
                    </a>
                </td>
            </tr>

            <tr th:if="${#lists.isEmpty(prescriptions)}">
                <td colspan="7" class="text-center text-muted py-3">
                    <i class="fa-regular fa-folder-open me-1"></i> Ch∆∞a c√≥ ƒë∆°n thu·ªëc n√†o
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>

<!-- Create Medical Record -->
<div th:fragment="create-record">
    <style>
        :root {
            --hm-blue: #005691;
            --hm-green: #008744;
        }

        .section-title {
            font-weight: 600;
            color: var(--hm-blue);
        }

        .btn-hm {
            background-color: var(--hm-blue);
            color: white;
        }

        .btn-hm:hover {
            background-color: #003f6f;
            color: white;
        }

        .form-label {
            font-weight: 500;
        }

        textarea {
            resize: vertical;
        }

        .form-section {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }
    </style>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="section-title mb-0">
            <i class="fa-solid fa-file-medical me-2"></i> Create medical records
        </h3>
        <a th:href="@{/doctor/appointments}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-arrow-left"></i> Back to Appointment
        </a>
    </div>

    <div class="form-section">
        <form th:action="@{/doctor/record/save}" th:object="${record}" method="post">
            <!-- Hidden fields -->
            <input type="hidden" name="appointmentId" th:value="${appointmentId}">
            <input type="hidden" name="patientId" th:value="${patientId}">

            <!-- Chu·∫©n ƒëo√°n -->
            <div class="mb-3">
                <label for="diagnosis" class="form-label">Diagnose <span class="text-danger">*</span></label>
                <textarea id="diagnosis" class="form-control" rows="3"
                          th:field="*{record.diagnosis}" placeholder="Enter your doctor's diagnosis..."
                          required></textarea>
                <div class="text-danger small" th:if="${#fields.hasErrors('diagnosis')}"
                     th:errors="*{record.diagnosis}"></div>
            </div>

            <!-- Ghi ch√∫ -->
            <div class="mb-3">
                <label for="notes" class="form-label">Note</label>
                <textarea id="notes" class="form-control" rows="4"
                          th:field="*{record.notes}"
                          placeholder="Additional notes about condition, medication, test results..."></textarea>
                <div class="text-danger small" th:if="${#fields.hasErrors('notes')}" th:errors="*{record.notes}"></div>
            </div>

            <!-- Tr·∫°ng th√°i -->
            <div class="mb-3">
                <label for="status" class="form-label">Status</label>
                <select id="status" class="form-select" th:field="*{record.recordStatus}">
                    <option th:each="s : ${T(com.group4.clinicmanagement.enums.RecordStatus).values()}"
                            th:value="${s.name()}"
                            th:text="${s.name() == 'OPEN' ? 'Open' : 'Close'}">>
                    </option>
                </select>
            </div>

            <!-- Submit -->
            <div class="d-flex justify-content-end mt-4">
                <button type="submit" class="btn btn-hm px-4">
                    <i class="fa-solid fa-floppy-disk me-1"></i> Save the file
                </button>
            </div>

        </form>
    </div>
</div>

<!-- Record Detail -->
<div th:fragment="record-detail">
    <div class="card p-4 shadow-sm">
        <h5 class="text-primary mb-4">
            <i class="fa-solid fa-file-medical me-2"></i> Medical Record Detail
        </h5>

        <!-- ‚úÖ Record Information -->
        <div class="mb-4">
            <h6 class="fw-bold text-secondary mb-2">ü©∫ Record Information</h6>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Record ID:</strong> <span th:text="${record.recordId}"></span></p>
                    <p><strong>Doctor:</strong> <span th:text="${record.doctorName}"></span></p>
                    <p><strong>Status:</strong>
                        <span th:text="${record.recordStatus}"
                              th:classappend="${record.recordStatus.name() == 'COMPLETED'} ? 'badge bg-success' : 'badge bg-warning text-dark'"></span>
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>Created At:</strong>
                        <span th:text="${#temporals.format(record.createdAt, 'dd/MM/yyyy HH:mm')}"></span></p>
                    <p><strong>Appointment ID:</strong> <span th:text="${record.appointmentId}"></span></p>
                    <p><strong>Patient:</strong> <span th:text="${record.patientName}"></span></p>
                </div>
            </div>
        </div>

        <hr/>

        <!-- ‚úÖ Medical Details -->
        <div class="card shadow-sm mb-4 border-0">
            <div class="card-body">
                <!-- Ti√™u ƒë·ªÅ v√† n√∫t Update tr√™n c√πng -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="fw-bold text-secondary mb-0">
                        <i class="fa-solid fa-brain me-2 text-primary"></i> Record Details
                    </h6>
                    <!-- create medical record -->
                    <a th:if="${record.recordId == null}"
                       th:href="@{'/doctor/records/create?appointmentId=' + ${appointmentId}}"
                       class="btn btn-outline-primary btn-sm">
                        <i class="fa-solid fa-plus me-1"></i> Create Medical Record
                    </a>

                    <!-- update medical record -->
                    <a th:if="${record.recordId != null and record.recordStatus.name() != 'CLOSED'}"
                       th:href="@{/doctor/records/update/{id}(id=${record.recordId})}"
                       class="btn btn-outline-primary btn-sm">
                        <i class="fa-solid fa-pen-to-square me-1"></i> Update Record
                    </a>
                </div>


                <!-- N·ªôi dung chi ti·∫øt -->
                <div class="ps-1">
                    <p class="mb-1">
                        <strong>Diagnosis:</strong>
                        <span th:text="${record.diagnosis ?: '-'}"></span>
                    </p>
                    <p class="mb-0">
                        <strong>Treatment Plan:</strong>
                        <span th:text="${record.notes ?: '-'}"></span>
                    </p>
                </div>
            </div>
        </div>

        <hr/>

        <!-- ‚úÖ Vital Signs -->
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-bold text-secondary">üíì Vital Signs</h6>

                <!-- üëâ N·∫øu c√≥ vitalSigns th√¨ ch·ªâ hi·ªán Update, n·∫øu ch∆∞a c√≥ th√¨ hi·ªán Create -->
                <a th:if="${vitalSigns == null}"
                   th:href="@{'/doctor/vitals/create?recordId=' + ${record.recordId}}"
                   class="btn btn-outline-primary btn-sm">
                    <i class="fa-solid fa-plus"></i> Add Vital Signs
                </a>

                <a th:if="${vitalSigns != null}"
                   th:href="@{/doctor/vitals/update/{id}(id = ${vitalSigns.vitalId})}"
                   class="btn btn-outline-primary btn-sm">
                    <i class="fa-solid fa-pen-to-square me-1"></i> Update Vital Signs
                </a>
            </div>

            <div th:if="${vitalSigns == null}" class="text-muted fst-italic">
                No vital signs recorded yet.
            </div>

            <div th:if="${vitalSigns != null}" class="table-responsive">
                <table class="table table-sm align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>Date</th>
                        <th>Height (cm)</th>
                        <th>Weight (kg)</th>
                        <th>Blood Pressure</th>
                        <th>Heart Rate</th>
                        <th>Temperature</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td th:text="${#temporals.format(vitalSigns.recordedAt, 'dd/MM/yyyy HH:mm')}"></td>
                        <td th:text="${vitalSigns.heightCm + ' cm'}"></td>
                        <td th:text="${vitalSigns.weightKg + ' kg'}"></td>
                        <td th:text="${vitalSigns.bloodPressure + ' mmHg'}"></td>
                        <td th:text="${vitalSigns.heartRate + ' bpm'}"></td>
                        <td th:text="${vitalSigns.temperature + ' ¬∞C'}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <hr/>

        <!-- ‚úÖ Prescription Detail -->
        <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="fw-bold text-secondary">üíä Prescription</h6>

                <!-- üëâ N·∫øu c√≥ prescription th√¨ ch·ªâ hi·ªán Update, n·∫øu ch∆∞a c√≥ th√¨ hi·ªán Create -->
                <a th:if="${prescription == null}"
                   th:href="@{'/doctor/prescription/create?recordId=' + ${record.recordId}}"
                   class="btn btn-outline-primary btn-sm">
                    <i class="fa-solid fa-plus"></i> Add Prescription
                </a>

                <a th:if="${prescription != null}"
                   th:href="@{/doctor/prescription/update/{id}(id=${prescription.prescriptionId})}"
                   class="btn btn-outline-primary btn-sm">
                    <i class="fa-solid fa-pen-to-square me-1"></i> Update Prescription
                </a>
            </div>

            <div th:if="${prescription == null}" class="text-muted fst-italic">
                No prescription created yet.
            </div>

            <div th:if="${prescription != null}">
                <p><strong>Prescription ID:</strong> <span th:text="${prescription.prescriptionId}"></span></p>

                <div th:if="${prescription.prescriptionDetails}" class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Drug</th>
                            <th>Dosage</th>
                            <th>Quantity</th>
                            <th>Notes</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="d, iter : ${prescription.prescriptionDetails}">
                            <td th:text="${iter.index + 1}"></td>
                            <td th:text="${d.drugName}"></td>
                            <td th:text="${d.dosage}"></td>
                            <td th:text="${d.quantity}"></td>
                            <td th:text="${d.instruction ?: '-'}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center">
            <!-- back to medical record detail -->
            <div class="d-flex justify-content-end">
                <a th:href="@{/doctor/appointments/detail/{id}(id=${appointmentId})}" class="btn btn-outline-secondary">
                    <i class="fa-solid fa-arrow-left"></i> Back
                </a>
            </div>

            <!-- submit form for patient -->
            <div class="d-flex justify-content-end mb-3"
                 th:if="${record.recordId != null and vitalSigns != null and prescription != null}">
                <form th:action="@{/doctor/submit}" method="post">
                    <input type="hidden" name="appointmentId" th:value="${appointmentId}">
                    <button type="submit" class="btn btn-success">
                        <i class="fa-solid fa-circle-check me-1"></i> Submit Record
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- fragment/doctor/lab-request.html -->
<div th:fragment="lab-request">
    <style>
        :root {
            --hm-blue: #005691;
            --hm-light: #eaf4fb;
        }

        body {
            background: #f8fafc;
            font-family: "Inter", sans-serif;
        }

        .card {
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .card-header {
            background: var(--hm-light);
            font-weight: 600;
            color: var(--hm-blue);
        }

        .btn-hm {
            background: var(--hm-blue);
            color: white;
            border-radius: 8px;
        }

        .btn-hm:hover {
            background: #003f6f;
        }
    </style>
    <div class="container mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-primary fw-semibold">
                <i class="fa-solid fa-flask-vial me-2"></i> Create Lab Request
            </h3>
        </div>

        <form th:action="@{/doctor/lab/save}" method="post" th:object="${lab}">

            <input type="hidden" th:field="*{recordId}">
            <input type="hidden" th:field="*{doctorId}">

            <div class="card mb-4">
                <div class="card-header"><i class="fa-solid fa-vial me-1"></i> Select Lab Tests</div>
                <div class="card-body">

                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                        <tr>
                            <th>Test</th>
                            <th>Quantity</th>
                            <th>Note</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody id="labBody">
                        <tr class="lab-row">
                            <td>
                                <select class="form-select" name="testIds">
                                    <option value="">-- Choose Test --</option>
                                    <option th:each="t : ${tests}"
                                            th:value="${t.testId}"
                                            th:text="${t.name}"></option>
                                </select>
                            </td>
                            <td><input type="number" name="quantities" class="form-control text-center" min="1"
                                       required></td>
                            <td><input type="text" name="instructions" class="form-control" placeholder="Optional note">
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm btn-outline-danger remove-row"><i
                                        class="fa-solid fa-trash"></i></button>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <button type="button" id="addRow" class="btn btn-outline-primary rounded-pill">
                        <i class="fa-solid fa-plus me-1"></i> Add Test
                    </button>

                </div>
            </div>

            <button class="btn btn-hm w-100 py-2 fw-semibold">
                <i class="fa-solid fa-floppy-disk me-1"></i> Save Lab Request
            </button>
        </form>

    </div>

    <script>
        document.getElementById("addRow").onclick = () => {
            let row = document.querySelector(".lab-row").cloneNode(true);
            row.querySelectorAll("input").forEach(i => i.value = "");
            row.querySelector("select").selectedIndex = 0;
            document.getElementById("labBody").appendChild(row);
        };

        document.addEventListener("click", e => {
            if (e.target.closest(".remove-row")) {
                if (document.querySelectorAll(".lab-row").length > 1)
                    e.target.closest(".lab-row").remove();
            }
        });
    </script>
</div>
