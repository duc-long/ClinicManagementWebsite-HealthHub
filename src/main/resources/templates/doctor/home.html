<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Doctor Home – HealHub</title>
    <link th:href="@{/assets/css/doctor.css}" rel="stylesheet">
    <!-- Bootstrap & Icons -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body>
<div th:insert="~{fragment/toast/toast :: toast}"></div>
<div id="app" class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <div class="logo">DR</div>
            <div class="title hide-when-collapsed">HealHub · Doctor</div>
        </div>

        <button id="toggleSidebar" class="toggle-btn d-none d-lg-flex" type="button">
            <i class="fa-solid fa-angles-left"></i>
            <span class="hide-when-collapsed">Thu gọn</span>
        </button>

        <nav class="nav" id="sideNav">
            <small class="hide-when-collapsed">OVERVIEW</small>
            <a href="#" data-section="dashboard" class="active">
                <span class="icon"><i class="fa-solid fa-house"></i></span>
                <span class="hide-when-collapsed">Dashboard</span>
            </a>
            <a href="#" data-section="appointments" th:classappend="${active == 'appointments'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-calendar-check"></i></span>
                <span class="hide-when-collapsed">Appointments</span>
            </a>
            <a href="#" data-section="patients">
                <span class="icon"><i class="fa-solid fa-user-group"></i></span>
                <span class="hide-when-collapsed">Patients</span>
            </a>
            <a href="#" data-section="schedule">
                <span class="icon"><i class="fa-solid fa-clock"></i></span>
                <span class="hide-when-collapsed">Schedule</span>
            </a>

            <small class="hide-when-collapsed mt-2">CARE</small>
            <a href="#" data-section="prescriptions">
                <span class="icon"><i class="fa-solid fa-prescription-bottle-medical"></i></span>
                <span class="hide-when-collapsed">Prescriptions</span>
            </a>
            <a href="#" data-section="messages">
                <span class="icon"><i class="fa-solid fa-message"></i></span>
                <span class="hide-when-collapsed">Messages</span>
            </a>

            <small class="hide-when-collapsed mt-2">ACCOUNT</small>
            <a href="#" data-section="profile" th:classappend="${active == 'profile'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-gear"></i></span>
                <span class="hide-when-collapsed">Profile</span>
            </a>
            <form th:action="@{/doctor/logout}" method="post" class="logout-form">
                <button type="submit" class="logout-btn text-danger">
                    <span class="icon"><i class="fa-solid fa-right-from-bracket text-danger"></i></span>
                    <span class="hide-when-collapsed">Logout</span>
                </button>
            </form>
        </nav>
    </aside>

    <section class="content" id="content">
        <!-- Settings -->
        <div class="section" id="section-settings"
             th:replace="~{fragment/doctor/doctor-fragment :: overview}"></div>
    </section>
</div>
<!-- Mobile overlay -->
<div class="overlay"></div>

<!-- Scripts -->
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script>
    (function () {
        const app = document.getElementById('app');
        const sideNav = document.getElementById('sideNav');
        const toggleBtn = document.getElementById('toggleSidebar');
        const openBtn = document.getElementById('openSidebar');
        const overlay = document.querySelector('.overlay');

        // restore sidebar state
        const key = 'doctorSidebarCollapsed';
        const saved = localStorage.getItem(key);
        if (saved === '1') app.classList.add('collapsed');

        // toggle collapse (desktop)
        toggleBtn.addEventListener('click', () => {
            app.classList.toggle('collapsed');
            localStorage.setItem(key, app.classList.contains('collapsed') ? '1' : '0');
        });

        // mobile open/close
        const openSidebar = () => app.classList.add('show-sidebar');
        const closeSidebar = () => app.classList.remove('show-sidebar');
        openBtn?.addEventListener('click', openSidebar);
        overlay?.addEventListener('click', closeSidebar);

        // section switching
        const sections = document.querySelectorAll('.section');
        const links = sideNav.querySelectorAll('a[data-section]');

        function showSection(name) {
            sections.forEach(s => s.classList.toggle('active', s.id === 'section-' + name));
            links.forEach(a => a.classList.toggle('active', a.dataset.section === name));
            // auto close on mobile
            closeSidebar();
        }

        sideNav.addEventListener('click', (e) => {
            const a = e.target.closest('a[data-section]');
            if (!a) return;
            e.preventDefault();
            showSection(a.dataset.section);
            history.replaceState(null, '', '#' + a.dataset.section); // optional hash
        });

        // open from hash if present (e.g., /doctor/home#patients)
        const hash = location.hash?.replace('#', '');
        if (hash) {
            const exists = document.getElementById('section-' + hash);
            if (exists) showSection(hash);
        }
    })();
</script>
<script th:src="@{/assets/js/doctor.js}"></script>
<script th:src="@{/assets/js/toast.js}"></script>
</body>
</html>
