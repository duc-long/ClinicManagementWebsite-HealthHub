<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Doctor Home ‚Äì HealHub</title>
    <link th:href="@{/assets/css/doctor.css}" rel="stylesheet">
    <!-- Bootstrap & Icons -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body>
<div th:insert="~{fragment/toast/toast :: toast}"></div>
<div id="app" class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <div class="logo">DR</div>
            <div class="title hide-when-collapsed">HealHub ¬∑ Doctor</div>
        </div>

        <button id="toggleSidebar" class="toggle-btn d-none d-lg-flex" type="button">
            <i class="fa-solid fa-angles-left"></i>
            <span class="hide-when-collapsed">Thu g·ªçn</span>
        </button>

        <nav class="nav flex-column" id="sideNav">
            <!-- ===== OVERVIEW ===== -->
            <small class="hide-when-collapsed text-muted fw-semibold mb-1">OVERVIEW</small>

            <a th:href="@{/doctor/home}" th:classappend="${active == 'home'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-house"></i></span>
                <span class="hide-when-collapsed">Home</span>
            </a>

            <a th:href="@{/doctor/appointments}" th:classappend="${active == 'appointments'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-calendar-check"></i></span>
                <span class="hide-when-collapsed">Appointments</span>
            </a>

            <!-- ===== PATIENT CARE FLOW ===== -->
            <small class="hide-when-collapsed text-muted fw-semibold mt-3 mb-1">CARE FLOW</small>

            <a th:href="@{/doctor/vitals}" th:classappend="${active == 'vitals'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-heart-pulse"></i></span>
                <span class="hide-when-collapsed">Vital Signs</span>
            </a>

            <a th:href="@{/doctor/records/list}" th:classappend="${active == 'records'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-file-medical"></i></span>
                <span class="hide-when-collapsed">Medical Records</span>
            </a>

            <a th:href="@{/doctor/lab-requests}" th:classappend="${active == 'labs'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-flask"></i></span>
                <span class="hide-when-collapsed">Lab Requests</span>
            </a>

            <a th:href="@{/doctor/prescriptions}" th:classappend="${active == 'prescriptions'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-pills"></i></span>
                <span class="hide-when-collapsed">Prescriptions</span>
            </a>

            <a th:href="@{/doctor/followup}" th:classappend="${active == 'followup'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-repeat"></i></span>
                <span class="hide-when-collapsed">Follow-up</span>
            </a>

            <!-- ===== COMMUNICATION ===== -->
            <small class="hide-when-collapsed text-muted fw-semibold mt-3 mb-1">COMMUNICATION</small>

            <a th:href="@{/doctor/messages}" th:classappend="${active == 'messages'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-message"></i></span>
                <span class="hide-when-collapsed">Messages</span>
            </a>

            <!-- ===== ACCOUNT ===== -->
            <small class="hide-when-collapsed text-muted fw-semibold mt-3 mb-1">ACCOUNT</small>

            <a th:href="@{/doctor/profile}" th:classappend="${active == 'profile'} ? ' active'">
                <span class="icon"><i class="fa-solid fa-user-gear"></i></span>
                <span class="hide-when-collapsed">Profile</span>
            </a>

            <form th:action="@{/doctor/logout}" method="post" class="logout-form mt-2">
                <button type="submit" class="logout-btn text-danger w-100 text-start">
                    <span class="icon"><i class="fa-solid fa-right-from-bracket text-danger"></i></span>
                    <span class="hide-when-collapsed">Logout</span>
                </button>
            </form>
        </nav>

    </aside>

    <section class="content" id="content">
        <!-- Settings -->
        <div class="section" id="section-settings"
             th:replace="~{fragment/doctor/doctor-fragment :: ${section}}"></div>
    </section>
</div>
<!-- Mobile overlay -->
<div class="overlay"></div>

<!-- üìÑ Pagination -->
<div class="d-flex justify-content-center mt-3" th:if="${totalPages > 1}">
    <nav>
        <ul class="pagination">
            <!-- Previous -->
            <li class="page-item" th:classappend="${currentPage == 0} ? ' disabled'">
                <a class="page-link"
                   th:href="@{/doctor/home(page=${currentPage - 1}, patientName=${patientName}, status=${status})}">
                    &laquo; Prev
                </a>
            </li>

            <!-- Page numbers -->
            <li class="page-item"
                th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? ' active'">
                <a class="page-link"
                   th:text="${i + 1}"
                   th:href="@{/doctor/home(page=${i}, patientName=${patientName}, status=${status})}"></a>
            </li>

            <!-- Next -->
            <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? ' disabled'">
                <a class="page-link"
                   th:href="@{/doctor/home(page=${currentPage + 1}, patientName=${patientName}, status=${status})}">
                    Next &raquo;
                </a>
            </li>
        </ul>
    </nav>
</div>

<!-- Scripts -->
<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
<script>
    (function () {
        const app = document.getElementById('app');
        const sideNav = document.getElementById('sideNav');
        const toggleBtn = document.getElementById('toggleSidebar');
        const openBtn = document.getElementById('openSidebar');
        const overlay = document.querySelector('.overlay');

        // restore sidebar state
        const key = 'doctorSidebarCollapsed';
        const saved = localStorage.getItem(key);
        if (saved === '1') app.classList.add('collapsed');

        // toggle collapse (desktop)
        toggleBtn.addEventListener('click', () => {
            app.classList.toggle('collapsed');
            localStorage.setItem(key, app.classList.contains('collapsed') ? '1' : '0');
        });

        // mobile open/close
        const openSidebar = () => app.classList.add('show-sidebar');
        const closeSidebar = () => app.classList.remove('show-sidebar');
        openBtn?.addEventListener('click', openSidebar);
        overlay?.addEventListener('click', closeSidebar);

        // section switching
        const sections = document.querySelectorAll('.section');
        const links = sideNav.querySelectorAll('a[data-section]');

        function showSection(name) {
            sections.forEach(s => s.classList.toggle('active', s.id === 'section-' + name));
            links.forEach(a => a.classList.toggle('active', a.dataset.section === name));
            // auto close on mobile
            closeSidebar();
        }

        sideNav.addEventListener('click', (e) => {
            const a = e.target.closest('a[data-section]');
            if (!a) return;
            e.preventDefault();
            showSection(a.dataset.section);
            history.replaceState(null, '', '#' + a.dataset.section); // optional hash
        });

        // open from hash if present (e.g., /doctor/home#patients)
        const hash = location.hash?.replace('#', '');
        if (hash) {
            const exists = document.getElementById('section-' + hash);
            if (exists) showSection(hash);
        }
    })();
</script>
<script th:src="@{/assets/js/toast.js}"></script>
</body>
</html>
